{"remainingRequest":"/Users/sunwenbo/Downloads/博客/new-blog-master/blog-vue/blog/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/sunwenbo/Downloads/博客/new-blog-master/blog-vue/blog/src/components/ChatRoom.vue?vue&type=style&index=0&id=56c7db03&scoped=true&lang=css&","dependencies":[{"path":"/Users/sunwenbo/Downloads/博客/new-blog-master/blog-vue/blog/src/components/ChatRoom.vue","mtime":1666926022000},{"path":"/Users/sunwenbo/Downloads/博客/new-blog-master/blog-vue/blog/node_modules/css-loader/dist/cjs.js","mtime":1670984987530},{"path":"/Users/sunwenbo/Downloads/博客/new-blog-master/blog-vue/blog/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1670984980196},{"path":"/Users/sunwenbo/Downloads/博客/new-blog-master/blog-vue/blog/node_modules/postcss-loader/src/index.js","mtime":1670984984011},{"path":"/Users/sunwenbo/Downloads/博客/new-blog-master/blog-vue/blog/node_modules/cache-loader/dist/cjs.js","mtime":1670984987973},{"path":"/Users/sunwenbo/Downloads/博客/new-blog-master/blog-vue/blog/node_modules/vue-loader/lib/index.js","mtime":1670984980185}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgpAbWVkaWEgKG1pbi13aWR0aDogNzYwcHgpIHsKICAuY2hhdC1jb250YWluZXIgewogICAgcG9zaXRpb246IGZpeGVkOwogICAgY29sb3I6ICM0YzQ5NDggIWltcG9ydGFudDsKICAgIGJvdHRvbTogMTA0cHg7CiAgICByaWdodDogMjBweDsKICAgIGhlaWdodDogY2FsYyg4NSUgLSA2NHB4IC0gMjBweCk7CiAgICBtYXgtaGVpZ2h0OiA1OTBweCAhaW1wb3J0YW50OwogICAgbWluLWhlaWdodDogMjUwcHggIWltcG9ydGFudDsKICAgIHdpZHRoOiA0MDBweCAhaW1wb3J0YW50OwogICAgYm9yZGVyLXJhZGl1czogMTZweCAhaW1wb3J0YW50OwogIH0KICAuY2xvc2UgewogICAgZGlzcGxheTogbm9uZTsKICB9Cn0KQG1lZGlhIChtYXgtd2lkdGg6IDc2MHB4KSB7CiAgLmNoYXQtY29udGFpbmVyIHsKICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgIHRvcDogMDsKICAgIGJvdHRvbTogMDsKICAgIHJpZ2h0OiAwOwogICAgbGVmdDogMDsKICB9CiAgLmNsb3NlIHsKICAgIGRpc3BsYXk6IGJsb2NrOwogICAgbWFyZ2luLWxlZnQ6IGF1dG87CiAgfQp9Ci5jaGF0LWNvbnRhaW5lciB7CiAgYm94LXNoYWRvdzogMCA1cHggNDBweCByZ2JhKDAsIDAsIDAsIDAuMTYpICFpbXBvcnRhbnQ7CiAgZm9udC1zaXplOiAxNHB4OwogIGJhY2tncm91bmQ6ICNmNGY2ZmI7CiAgei1pbmRleDogMTIwMDsKfQouY2hhdC1idG4gewogIGJhY2tncm91bmQ6ICMxZjkzZmY7CiAgYm9yZGVyLXJhZGl1czogMTAwcHggIWltcG9ydGFudDsKICBwb3NpdGlvbjogZml4ZWQ7CiAgYm90dG9tOiAxNXB4OwogIHJpZ2h0OiA1cHg7CiAgYm94LXNoYWRvdzogMCA4cHggMjRweCByZ2JhKDAsIDAsIDAsIDAuMTYpICFpbXBvcnRhbnQ7CiAgY3Vyc29yOiBwb2ludGVyOwogIGhlaWdodDogNjBweCAhaW1wb3J0YW50OwogIHdpZHRoOiA2MHB4ICFpbXBvcnRhbnQ7CiAgei1pbmRleDogMTAwMCAhaW1wb3J0YW50OwogIHVzZXItc2VsZWN0OiBub25lOwp9Ci5oZWFkZXIgewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBwYWRkaW5nOiAyMHB4IDI0cHg7CiAgYmFja2dyb3VuZDogI2ZmZmZmZjsKICBib3JkZXItcmFkaXVzOiAxcmVtIDFyZW0gMCAwOwogIGJveC1zaGFkb3c6IDAgMTBweCAxNXB4IC0xNnB4IHJnYmEoNTAsIDUwLCA5MywgMC4wOCksCiAgICAwIDRweCA2cHggLThweCByZ2JhKDUwLCA1MCwgOTMsIDAuMDQpOwp9Ci5mb290ZXIgewogIHBhZGRpbmc6IDhweCAxNnB4OwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB3aWR0aDogMTAwJTsKICBib3R0b206IDA7CiAgYmFja2dyb3VuZDogI2Y3ZjdmNzsKICBib3JkZXItcmFkaXVzOiAwIDAgMXJlbSAxcmVtOwogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKfQouZm9vdGVyIHRleHRhcmVhIHsKICBiYWNrZ3JvdW5kOiAjZmZmOwogIHBhZGRpbmctbGVmdDogMTBweDsKICBwYWRkaW5nLXRvcDogOHB4OwogIHdpZHRoOiAxMDAlOwogIGhlaWdodDogMzJweDsKICBvdXRsaW5lOiBub25lOwogIHJlc2l6ZTogbm9uZTsKICBvdmVyZmxvdzogaGlkZGVuOwogIGZvbnQtc2l6ZTogMTNweDsKfQoudm9pY2UtYnRuIHsKICBmb250LXNpemU6IDEzcHg7CiAgb3V0bGluZTogbm9uZTsKICBoZWlnaHQ6IDMycHg7CiAgd2lkdGg6IDEwMCU7CiAgYmFja2dyb3VuZDogI2ZmZjsKICBib3JkZXItcmFkaXVzOiAycHg7Cn0KLm1lc3NhZ2UgewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB3aWR0aDogMTAwJTsKICBwYWRkaW5nOiAyMHB4IDE2cHggMCAxNnB4OwogIHRvcDogODBweDsKICBib3R0b206IDUwcHg7CiAgb3ZlcmZsb3cteTogYXV0bzsKICBvdmVyZmxvdy14OiBoaWRkZW47Cn0KLnRleHQgewogIGNvbG9yOiAjOTk5OwogIHRleHQtYWxpZ246IGNlbnRlcjsKICBmb250LXNpemU6IDEycHg7CiAgbWFyZ2luLWJvdHRvbTogMTJweDsKfQoudXNlci1tZXNzYWdlIHsKICBkaXNwbGF5OiBmbGV4OwogIG1hcmdpbi1ib3R0b206IDEwcHg7Cn0KLm15LW1lc3NhZ2UgewogIGRpc3BsYXk6IGZsZXg7CiAgbWFyZ2luLWJvdHRvbTogMTBweDsKICBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtZW5kOwp9Ci5sZWZ0LWF2YXRhciB7CiAgbWFyZ2luLXJpZ2h0OiAxMHB4Owp9Ci5yaWdodC1hdmF0YXIgewogIG9yZGVyOiAxOwogIG1hcmdpbi1sZWZ0OiAxMHB4Owp9Ci51c2VyLWF2YXRhciB7CiAgd2lkdGg6IDQwcHg7CiAgaGVpZ2h0OiA0MHB4OwogIGJvcmRlci1yYWRpdXM6IDUwJTsKfQoubmlja25hbWUgewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBmb250LXNpemU6IDEycHg7CiAgbWFyZ2luLXRvcDogM3B4OwogIG1hcmdpbi1ib3R0b206IDVweDsKfQoudXNlci1jb250ZW50IHsKICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKICBwYWRkaW5nOiAxMHB4OwogIGJvcmRlci1yYWRpdXM6IDVweCAyMHB4IDIwcHggMjBweDsKICB3aWR0aDogZml0LWNvbnRlbnQ7CiAgd2hpdGUtc3BhY2U6IHByZS1saW5lOwogIHdvcmQtd3JhcDogYnJlYWstd29yZDsKICB3b3JkLWJyZWFrOiBicmVhay1hbGw7Cn0KLm15LWNvbnRlbnQgewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICBib3JkZXItcmFkaXVzOiAyMHB4IDVweCAyMHB4IDIwcHg7CiAgcGFkZGluZzogMTJweDsKICBiYWNrZ3JvdW5kOiAjMTJiN2Y1OwogIGNvbG9yOiAjZmZmOwogIHdoaXRlLXNwYWNlOiBwcmUtbGluZTsKICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7CiAgd29yZC1icmVhazogYnJlYWstYWxsOwp9Ci5zdWJtaXQtYnRuIHsKICBjb2xvcjogcmdiKDMxLCAxNDcsIDI1NSk7Cn0KLmVtb2ppIHsKICBjdXJzb3I6IHBvaW50ZXI7CiAgZm9udC1zaXplOiAxLjNyZW07CiAgbWFyZ2luOiAwIDhweDsKfQouZW1vamktYm94IHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgYm94LXNoYWRvdzogMCA4cHggMTZweCByZ2JhKDUwLCA1MCwgOTMsIDAuMDgpLCAwIDRweCAxMnB4IHJnYmEoMCwgMCwgMCwgMC4wNyk7CiAgYmFja2dyb3VuZDogI2ZmZjsKICBib3JkZXItcmFkaXVzOiA4cHg7CiAgcmlnaHQ6IDIwcHg7CiAgYm90dG9tOiA1MnB4OwogIGhlaWdodDogMTgwcHg7CiAgd2lkdGg6IDMwMHB4OwogIG92ZXJmbG93LXk6IGF1dG87CiAgcGFkZGluZzogNnB4IDE2cHg7Cn0KLmVtb2ppLWJvcmRlcjpiZWZvcmUgewogIGRpc3BsYXk6IGJsb2NrOwogIGhlaWdodDogMDsKICB3aWR0aDogMDsKICBjb250ZW50OiAiIjsKICBib3JkZXItbGVmdDogMTRweCBzb2xpZCB0cmFuc3BhcmVudDsKICBib3JkZXItcmlnaHQ6IDE0cHggc29saWQgdHJhbnNwYXJlbnQ7CiAgYm9yZGVyLXRvcDogMTJweCBzb2xpZCAjZmZmOwogIGJvdHRvbTogNDBweDsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgcmlnaHQ6IDQzcHg7Cn0KLnVucmVhZCB7CiAgdGV4dC1hbGlnbjogY2VudGVyOwogIGJvcmRlci1yYWRpdXM6IDUwJTsKICBmb250LXNpemU6IDE0cHg7CiAgaGVpZ2h0OiAyMHB4OwogIHdpZHRoOiAyMHB4OwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICBiYWNrZ3JvdW5kOiAjZjI0ZjJkOwogIGNvbG9yOiAjZmZmOwp9Ci5iYWNrLW1lbnUgewogIGZvbnQtc2l6ZTogMTNweDsKICBib3JkZXItcmFkaXVzOiAycHg7CiAgcG9zaXRpb246IGFic29sdXRlOwogIGJhY2tncm91bmQ6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC45KTsKICBjb2xvcjogIzAwMDsKICB3aWR0aDogODBweDsKICBoZWlnaHQ6IDM1cHg7CiAgdGV4dC1hbGlnbjogY2VudGVyOwogIGxpbmUtaGVpZ2h0OiAzNXB4OwogIGRpc3BsYXk6IG5vbmU7Cn0KLnZvaWNlIHsKICBwb3NpdGlvbjogZml4ZWQ7CiAgei1pbmRleDogMTUwMDsKICBib3R0b206IDUycHg7CiAgbGVmdDogMDsKICByaWdodDogMDsKICB0b3A6IDgwcHg7CiAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjgpOwp9Ci5jbG9zZS12b2ljZSB7CiAgcG9zaXRpb246IGFic29sdXRlOwogIGJvdHRvbTogNjBweDsKICBsZWZ0OiAzMHB4OwogIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICBoZWlnaHQ6IDUwcHg7CiAgd2lkdGg6IDUwcHg7CiAgbGluZS1oZWlnaHQ6IDUwcHg7CiAgYm9yZGVyLXJhZGl1czogNTAlOwogIHRleHQtYWxpZ246IGNlbnRlcjsKICBiYWNrZ3JvdW5kOiAjZmZmOwp9Cg=="},{"version":3,"sources":["ChatRoom.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ChatRoom.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div>\n    <!-- 聊天界面 -->\n    <div\n      class=\"chat-container animated bounceInUp\"\n      v-show=\"isShow\"\n      @click=\"closeAll\"\n      @contextmenu.prevent.stop=\"closeAll\"\n    >\n      <!-- 标题 -->\n      <div class=\"header\">\n        <img\n          width=\"32\"\n          height=\"32\"\n          src=\"https://static.talkxj.com/config/logo.png\"\n        />\n        <div style=\"margin-left:12px\">\n          <div>聊天室</div>\n          <div style=\"font-size:12px\">当前{{ count }}人在线</div>\n        </div>\n        <v-icon class=\"close\" @click=\"isShow = false\">\n          mdi-close\n        </v-icon>\n      </div>\n      <!-- 对话内容 -->\n      <div class=\"message\" id=\"message\">\n        <!-- 录音遮罩层 -->\n        <div\n          v-show=\"voiceActive\"\n          class=\"voice\"\n          @mousemove.prevent.stop=\"translationmove($event)\"\n          @mouseup.prevent.stop=\"translationEnd($event)\"\n        >\n          <v-icon ref=\"voiceClose\" class=\"close-voice\">mdi-close</v-icon>\n        </div>\n        <div\n          :class=\"isMyMessage(item)\"\n          v-for=\"(item, index) of chatRecordList\"\n          :key=\"index\"\n        >\n          <!-- 头像 -->\n          <img :src=\"item.avatar\" :class=\"isleft(item)\" />\n          <div>\n            <div class=\"nickname\" v-if=\"!isSelf(item)\">\n              {{ item.nickname }}\n              <span style=\"margin-left:12px\">{{ item.createTime | hour }}</span>\n            </div>\n            <!-- 内容 -->\n            <div\n              ref=\"content\"\n              @contextmenu.prevent.stop=\"showBack(item, index, $event)\"\n              :class=\"isMyContent(item)\"\n            >\n              <!-- 文字消息 -->\n              <div v-if=\"item.type == 3\" v-html=\"item.content\" />\n              <!-- 语音消息 -->\n              <div v-if=\"item.type == 5\" @click.prevent.stop=\"playVoice(item)\">\n                <audio\n                  @ended=\"endVoice(item)\"\n                  @canplay=\"getVoiceTime(item)\"\n                  ref=\"voices\"\n                  :src=\"item.content\"\n                  style=\"display:none\"\n                />\n                <!-- 播放 -->\n                <v-icon\n                  :color=\"isSelf(item) ? '#fff' : '#000'\"\n                  ref=\"plays\"\n                  style=\"display:inline-flex;cursor: pointer;\"\n                >\n                  mdi-arrow-right-drop-circle\n                </v-icon>\n                <!-- 暂停 -->\n                <v-icon\n                  :color=\"isSelf(item) ? '#fff' : '#000'\"\n                  ref=\"pauses\"\n                  style=\"display:none;cursor: pointer;\"\n                >\n                  mdi-pause-circle\n                </v-icon>\n                <!-- 音频时长 -->\n                <span ref=\"voiceTimes\" />\n              </div>\n              <div class=\"back-menu\" ref=\"backBtn\" @click=\"back(item, index)\">\n                撤回\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <!-- 输入框 -->\n      <div class=\"footer\">\n        <!-- 表情框 -->\n        <div class=\"emoji-box\" v-show=\"isEmoji\">\n          <Emoji :chooseEmoji=\"true\" @addEmoji=\"addEmoji\" />\n        </div>\n        <div class=\"emoji-border\" v-show=\"isEmoji\" />\n        <!-- 切换输入方式 -->\n        <v-icon\n          v-show=\"!isVoice\"\n          @click=\"isVoice = !isVoice\"\n          style=\"margin-right: 8px\"\n        >\n          mdi-microphone\n        </v-icon>\n        <v-icon\n          v-show=\"isVoice\"\n          @click=\"isVoice = !isVoice\"\n          style=\"margin-right: 8px\"\n        >\n          mdi-keyboard\n        </v-icon>\n        <!-- 文字输入 -->\n        <textarea\n          v-show=\"!isVoice\"\n          ref=\"chatInput\"\n          v-model=\"content\"\n          @keydown.enter=\"saveMessage($event)\"\n          placeholder=\"请输入内容\"\n        />\n        <!-- 语音输入 -->\n        <button\n          class=\"voice-btn\"\n          v-show=\"isVoice\"\n          @mousedown.prevent.stop=\"translationStart\"\n          @mouseup.prevent.stop=\"translationEnd($event)\"\n          @touchstart.prevent.stop=\"translationStart\"\n          @touchend.prevent.stop=\"translationEnd($event)\"\n          @touchmove.prevent.stop=\"translationmove($event)\"\n        >\n          按住说话\n        </button>\n        <!-- 表情 -->\n        <i\n          class=\"iconfont iconbiaoqing emoji\"\n          :style=\"isEmoji ? 'color:#FFC83D' : ''\"\n          @click.prevent.stop=\"openEmoji\"\n        />\n        <!-- 发送按钮 -->\n        <i :class=\"isInput\" @click=\"saveMessage\" style=\"font-size: 1.5rem\" />\n      </div>\n    </div>\n    <!-- 未读数量 -->\n    <div class=\"chat-btn\" @click=\"open\">\n      <span class=\"unread\" v-if=\"unreadCount > 0\">{{ unreadCount }}</span>\n      <img\n        width=\"100%\"\n        height=\"100%\"\n        src=\"https://static.talkxj.com/config/logo.png\"\n      />\n    </div>\n  </div>\n</template>\n\n<script>\nimport Recorderx, { ENCODE_TYPE } from \"recorderx\";\nimport Emoji from \"./Emoji\";\nimport EmojiList from \"../assets/js/emoji\";\nexport default {\n  components: {\n    Emoji\n  },\n  updated() {\n    var ele = document.getElementById(\"message\");\n    ele.scrollTop = ele.scrollHeight;\n  },\n  beforeDestroy() {\n    clearInterval(this.heartBeat);\n  },\n  data: function() {\n    return {\n      isEmoji: false,\n      isShow: false,\n      websocket: null,\n      content: \"\",\n      chatRecordList: [],\n      voiceList: [],\n      rc: null,\n      ipAddress: \"\",\n      ipSource: \"\",\n      count: 0,\n      unreadCount: 0,\n      isVoice: false,\n      voiceActive: false,\n      startVoiceTime: null,\n      WebsocketMessage: {\n        type: null,\n        data: null\n      },\n      heartBeat: null\n    };\n  },\n  methods: {\n    open() {\n      if (this.websocket == null) {\n        this.connect();\n      }\n      this.unreadCount = 0;\n      this.isShow = !this.isShow;\n    },\n    openEmoji() {\n      this.isEmoji = !this.isEmoji;\n      this.isVoice = false;\n    },\n    connect() {\n      var that = this;\n      this.websocket = new WebSocket(this.blogInfo.websiteConfig.websocketUrl);\n      // 连接发生错误的回调方法\n      this.websocket.onerror = function(event) {\n        console.log(event);\n        alert(\"失败\");\n      };\n      // 连接成功建立的回调方法\n      this.websocket.onopen = function(event) {\n        console.log(event);\n        // 发送心跳消息\n        that.heartBeat = setInterval(function() {\n          var beatMessage = {\n            type: 6,\n            data: \"ping\"\n          };\n          that.websocket.send(JSON.stringify(beatMessage));\n        }, 30 * 1000);\n      };\n      // 接收到消息的回调方法\n      this.websocket.onmessage = function(event) {\n        const data = JSON.parse(event.data);\n        switch (data.type) {\n          case 1:\n            // 在线人数\n            that.count = data.data;\n            break;\n          case 2:\n            // 历史记录\n            that.chatRecordList = data.data.chatRecordList;\n            that.chatRecordList.forEach(item => {\n              if (item.type == 5) {\n                that.voiceList.push(item.id);\n              }\n            });\n            that.ipAddress = data.data.ipAddress;\n            that.ipSource = data.data.ipSource;\n            break;\n          case 3:\n            // 文字消息\n            that.chatRecordList.push(data.data);\n            if (!that.isShow) {\n              that.unreadCount++;\n            }\n            break;\n          case 4:\n            // 撤回\n            if (data.data.isVoice) {\n              that.voiceList.splice(that.voiceList.indexOf(data.data.id), 1);\n            }\n            for (var i = 0; i < that.chatRecordList.length; i++) {\n              if (that.chatRecordList[i].id == data.data.id) {\n                that.chatRecordList.splice(i, 1);\n                i--;\n              }\n            }\n            break;\n          case 5:\n            // 语音消息\n            that.voiceList.push(data.data.id);\n            that.chatRecordList.push(data.data);\n            if (!that.isShow) {\n              that.unreadCount++;\n            }\n            break;\n        }\n      };\n      //连接关闭的回调方法\n      this.websocket.onclose = function() {};\n    },\n    saveMessage(e) {\n      e.preventDefault();\n      if (this.content.trim() == \"\") {\n        this.$toast({ type: \"error\", message: \"内容不能为空\" });\n        return false;\n      }\n      //解析表情\n      var reg = /\\[.+?\\]/g;\n      this.content = this.content.replace(reg, function(str) {\n        return (\n          \"<img src= '\" +\n          EmojiList[str] +\n          \"' width='24'height='24' style='margin: 0 1px;vertical-align: text-bottom'/>\"\n        );\n      });\n      var socketMsg = {\n        nickname: this.nickname,\n        avatar: this.avatar,\n        content: this.content,\n        userId: this.userId,\n        type: 3,\n        ipAddress: this.ipAddress,\n        ipSource: this.ipSource\n      };\n      this.WebsocketMessage.type = 3;\n      this.WebsocketMessage.data = socketMsg;\n      this.websocket.send(JSON.stringify(this.WebsocketMessage));\n      this.content = \"\";\n    },\n    addEmoji(key) {\n      this.isEmoji = false;\n      this.$refs.chatInput.focus();\n      this.content += key;\n    },\n    // 展示菜单\n    showBack(item, index, e) {\n      this.$refs.backBtn.forEach(item => {\n        item.style.display = \"none\";\n      });\n      if (\n        item.ipAddress == this.ipAddress ||\n        (item.userId != null && item.userId == this.userId)\n      ) {\n        this.$refs.backBtn[index].style.left = e.offsetX + \"px\";\n        this.$refs.backBtn[index].style.bottom = e.offsetY + \"px\";\n        this.$refs.backBtn[index].style.display = \"block\";\n      }\n    },\n    // 撤回消息\n    back(item, index) {\n      var socketMsg = {\n        id: item.id,\n        isVoice: item.type == 5\n      };\n      this.WebsocketMessage.type = 4;\n      this.WebsocketMessage.data = socketMsg;\n      this.websocket.send(JSON.stringify(this.WebsocketMessage));\n      this.$refs.backBtn[index].style.display = \"none\";\n    },\n    closeAll() {\n      this.isEmoji = false;\n      if (this.chatRecordList.length > 0) {\n        this.$refs.backBtn.forEach(item => {\n          item.style.display = \"none\";\n        });\n      }\n    },\n    // 录音开始\n    translationStart() {\n      this.voiceActive = true;\n      let that = this;\n      that.rc = new Recorderx();\n      that.$nextTick(() => {\n        that.rc\n          .start()\n          .then(() => {\n            that.startVoiceTime = new Date();\n            console.log(\"start recording\");\n          })\n          .catch(error => {\n            console.log(\"Recording failed.\", error);\n          });\n      });\n    },\n    // 录音结束\n    translationEnd() {\n      console.log(\"结束\");\n      this.voiceActive = false;\n      this.rc.pause();\n      if (new Date() - this.startVoiceTime < 1000) {\n        this.$toast({ type: \"error\", message: \"按键时间太短\" });\n        return false;\n      }\n      var wav = this.rc.getRecord({\n        encodeTo: ENCODE_TYPE.WAV\n      });\n      var file = new File([wav], \"voice.wav\", {\n        type: wav.type\n      });\n      var formData = new window.FormData();\n      formData.append(\"file\", file);\n      formData.append(\"type\", 5);\n      formData.append(\"nickname\", this.nickname);\n      formData.append(\"avatar\", this.avatar);\n      if (this.userId != null) {\n        formData.append(\"userId\", this.userId);\n      }\n      formData.append(\"ipAddress\", this.ipAddress);\n      formData.append(\"ipSource\", this.ipSource);\n      var options = {\n        url: \"/api/voice\",\n        data: formData,\n        method: \"post\",\n        headers: {\n          \"Content-Type\": \"multipart/form-data\"\n        }\n      };\n      this.axios(options);\n    },\n    translationmove() {},\n    // 播放语音\n    playVoice(item) {\n      var player = this.$refs.voices[this.voiceList.indexOf(item.id)];\n      if (player.paused) {\n        player.play();\n        this.$refs.plays[this.voiceList.indexOf(item.id)].$el.style.display =\n          \"none\";\n        this.$refs.pauses[this.voiceList.indexOf(item.id)].$el.style.display =\n          \"inline-flex\";\n      } else {\n        this.$refs.plays[this.voiceList.indexOf(item.id)].$el.style.display =\n          \"inline-flex\";\n        this.$refs.pauses[this.voiceList.indexOf(item.id)].$el.style.display =\n          \"none\";\n        player.pause();\n      }\n    },\n    // 语音结束\n    endVoice(item) {\n      this.$refs.plays[this.voiceList.indexOf(item.id)].$el.style.display =\n        \"inline-flex\";\n      this.$refs.pauses[this.voiceList.indexOf(item.id)].$el.style.display =\n        \"none\";\n    },\n    // 获取语音时长\n    getVoiceTime(item) {\n      var time = this.$refs.voices[this.voiceList.indexOf(item.id)].duration;\n      time = Math.ceil(time);\n      var str = \"⬝⬝⬝\";\n      for (var i = 0; i < time; i++) {\n        if (i % 2 == 0) {\n          str += \"⬝\";\n        }\n      }\n      this.$refs.voiceTimes[this.voiceList.indexOf(item.id)].innerHTML =\n        \" \" + str + \" \" + time + \" ''\";\n    }\n  },\n  computed: {\n    isSelf() {\n      return function(item) {\n        return (\n          item.ipAddress == this.ipAddress ||\n          (item.userId != null && item.userId == this.userId)\n        );\n      };\n    },\n    isleft() {\n      return function(item) {\n        return this.isSelf(item)\n          ? \"user-avatar right-avatar\"\n          : \"user-avatar left-avatar\";\n      };\n    },\n    isMyContent() {\n      return function(item) {\n        return this.isSelf(item) ? \"my-content\" : \"user-content\";\n      };\n    },\n    isMyMessage() {\n      return function(item) {\n        return this.isSelf(item) ? \"my-message\" : \"user-message\";\n      };\n    },\n    blogInfo() {\n      return this.$store.state.blogInfo;\n    },\n    nickname() {\n      return this.$store.state.nickname != null\n        ? this.$store.state.nickname\n        : this.ipAddress;\n    },\n    avatar() {\n      return this.$store.state.avatar != null\n        ? this.$store.state.avatar\n        : this.$store.state.blogInfo.websiteConfig.touristAvatar;\n    },\n    userId() {\n      return this.$store.state.userId;\n    },\n    isInput() {\n      return this.content.trim() != \"\"\n        ? \"iconfont iconzhifeiji submit-btn\"\n        : \"iconfont iconzhifeiji\";\n    }\n  }\n};\n</script>\n\n<style scoped>\n@media (min-width: 760px) {\n  .chat-container {\n    position: fixed;\n    color: #4c4948 !important;\n    bottom: 104px;\n    right: 20px;\n    height: calc(85% - 64px - 20px);\n    max-height: 590px !important;\n    min-height: 250px !important;\n    width: 400px !important;\n    border-radius: 16px !important;\n  }\n  .close {\n    display: none;\n  }\n}\n@media (max-width: 760px) {\n  .chat-container {\n    position: fixed;\n    top: 0;\n    bottom: 0;\n    right: 0;\n    left: 0;\n  }\n  .close {\n    display: block;\n    margin-left: auto;\n  }\n}\n.chat-container {\n  box-shadow: 0 5px 40px rgba(0, 0, 0, 0.16) !important;\n  font-size: 14px;\n  background: #f4f6fb;\n  z-index: 1200;\n}\n.chat-btn {\n  background: #1f93ff;\n  border-radius: 100px !important;\n  position: fixed;\n  bottom: 15px;\n  right: 5px;\n  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.16) !important;\n  cursor: pointer;\n  height: 60px !important;\n  width: 60px !important;\n  z-index: 1000 !important;\n  user-select: none;\n}\n.header {\n  display: flex;\n  align-items: center;\n  padding: 20px 24px;\n  background: #ffffff;\n  border-radius: 1rem 1rem 0 0;\n  box-shadow: 0 10px 15px -16px rgba(50, 50, 93, 0.08),\n    0 4px 6px -8px rgba(50, 50, 93, 0.04);\n}\n.footer {\n  padding: 8px 16px;\n  position: absolute;\n  width: 100%;\n  bottom: 0;\n  background: #f7f7f7;\n  border-radius: 0 0 1rem 1rem;\n  display: flex;\n  align-items: center;\n}\n.footer textarea {\n  background: #fff;\n  padding-left: 10px;\n  padding-top: 8px;\n  width: 100%;\n  height: 32px;\n  outline: none;\n  resize: none;\n  overflow: hidden;\n  font-size: 13px;\n}\n.voice-btn {\n  font-size: 13px;\n  outline: none;\n  height: 32px;\n  width: 100%;\n  background: #fff;\n  border-radius: 2px;\n}\n.message {\n  position: absolute;\n  width: 100%;\n  padding: 20px 16px 0 16px;\n  top: 80px;\n  bottom: 50px;\n  overflow-y: auto;\n  overflow-x: hidden;\n}\n.text {\n  color: #999;\n  text-align: center;\n  font-size: 12px;\n  margin-bottom: 12px;\n}\n.user-message {\n  display: flex;\n  margin-bottom: 10px;\n}\n.my-message {\n  display: flex;\n  margin-bottom: 10px;\n  justify-content: flex-end;\n}\n.left-avatar {\n  margin-right: 10px;\n}\n.right-avatar {\n  order: 1;\n  margin-left: 10px;\n}\n.user-avatar {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n}\n.nickname {\n  display: flex;\n  align-items: center;\n  font-size: 12px;\n  margin-top: 3px;\n  margin-bottom: 5px;\n}\n.user-content {\n  position: relative;\n  background-color: #fff;\n  padding: 10px;\n  border-radius: 5px 20px 20px 20px;\n  width: fit-content;\n  white-space: pre-line;\n  word-wrap: break-word;\n  word-break: break-all;\n}\n.my-content {\n  position: relative;\n  border-radius: 20px 5px 20px 20px;\n  padding: 12px;\n  background: #12b7f5;\n  color: #fff;\n  white-space: pre-line;\n  word-wrap: break-word;\n  word-break: break-all;\n}\n.submit-btn {\n  color: rgb(31, 147, 255);\n}\n.emoji {\n  cursor: pointer;\n  font-size: 1.3rem;\n  margin: 0 8px;\n}\n.emoji-box {\n  position: absolute;\n  box-shadow: 0 8px 16px rgba(50, 50, 93, 0.08), 0 4px 12px rgba(0, 0, 0, 0.07);\n  background: #fff;\n  border-radius: 8px;\n  right: 20px;\n  bottom: 52px;\n  height: 180px;\n  width: 300px;\n  overflow-y: auto;\n  padding: 6px 16px;\n}\n.emoji-border:before {\n  display: block;\n  height: 0;\n  width: 0;\n  content: \"\";\n  border-left: 14px solid transparent;\n  border-right: 14px solid transparent;\n  border-top: 12px solid #fff;\n  bottom: 40px;\n  position: absolute;\n  right: 43px;\n}\n.unread {\n  text-align: center;\n  border-radius: 50%;\n  font-size: 14px;\n  height: 20px;\n  width: 20px;\n  position: absolute;\n  background: #f24f2d;\n  color: #fff;\n}\n.back-menu {\n  font-size: 13px;\n  border-radius: 2px;\n  position: absolute;\n  background: rgba(255, 255, 255, 0.9);\n  color: #000;\n  width: 80px;\n  height: 35px;\n  text-align: center;\n  line-height: 35px;\n  display: none;\n}\n.voice {\n  position: fixed;\n  z-index: 1500;\n  bottom: 52px;\n  left: 0;\n  right: 0;\n  top: 80px;\n  background: rgba(0, 0, 0, 0.8);\n}\n.close-voice {\n  position: absolute;\n  bottom: 60px;\n  left: 30px;\n  display: inline-block;\n  height: 50px;\n  width: 50px;\n  line-height: 50px;\n  border-radius: 50%;\n  text-align: center;\n  background: #fff;\n}\n</style>\n"]}]}